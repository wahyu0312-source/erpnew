<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>東京精密発條株式会社システム</title>

  <!-- 基本スタイル（軽量） -->
  <style>
    :root{
      --bg:#f6f7fb; --panel:#fff; --ink:#0f172a; --muted:#6b7280; --border:#e5e7eb;
      --primary:#0ea5a4; --primary-ink:#fff; --chip:#eef2ff;
      --radius:14px; --shadow:0 8px 30px rgba(15,23,42,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif}

    /* ヘッダー */
    header{
      position:sticky; top:0; z-index:40; background:#ffffffd6; backdrop-filter:saturate(130%) blur(10px);
      border-bottom:1px solid var(--border);
    }
    .h-wrap{max-width:1200px;margin:0 auto;height:56px;display:flex;align-items:center;gap:10px;padding:0 12px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .grow{flex:1}
    .top-actions{display:flex;align-items:center;gap:8px}
    .chip{display:inline-flex;align-items:center;gap:8px;height:34px;padding:0 12px;border:1px solid var(--border);border-radius:999px;background:#fff}
    .chip.primary{background:var(--primary);color:var(--primary-ink);border-color:transparent}
    .wx{display:flex;align-items:center;gap:8px;color:var(--muted);font-weight:700}

    /* 上部ナビ（右寄せ固定） */
    .nav{max-width:1200px;margin:8px auto 0;display:flex;justify-content:flex-end;gap:10px;padding:0 12px;flex-wrap:wrap}
    .nav .btn{
      height:34px;padding:0 12px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer
    }
    .nav .btn.active{background:var(--chip);}

    /* ページ領域 */
    main{max-width:1200px;margin:12px auto;padding:0 12px}
    .card{background:#fff;border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .section{padding:14px}

    .hidden{display:none !important;}
    .s{font-size:12px;color:var(--muted)}

    /* テーブル（簡易） */
    .table-wrap{overflow:auto;border:1px solid var(--border);border-radius:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;border-bottom:1px solid var(--border);text-align:left;white-space:nowrap}
    th{background:#fafbff;font-weight:700}

    /* ダイアログ */
    dialog{border:0;border-radius:16px;box-shadow:var(--shadow);padding:16px}
    dialog::backdrop{background:rgba(0,0,0,.2)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    /* フッタースペース */
    .spacer{height:40px}
  </style>
</head>
<body>
  <!-- ========= Header ========= -->
  <header>
    <div class="h-wrap">
      <div class="brand">東京精密発條株式会社システム</div>
      <div class="grow"></div>
      <div id="weatherWrap" class="wx hidden">
        <span id="wxTemp">—°C</span><span>/</span>
        <span id="wxWind">— m/s</span>
        <span id="wxPlace" class="s">—</span>
      </div>
      <div id="userInfo" class="chip s"></div>
      <button id="btnLogout" class="chip hidden">ログアウト</button>
    </div>
  </header>

  <!-- ========= Top nav (RIGHT aligned) ========= -->
  <nav class="nav">
    <button id="btnToDash" class="btn hidden">ダッシュボード</button>
    <button id="btnToSales" class="btn hidden">受注</button>
    <button id="btnToPlan" class="btn hidden">生産計画</button>
    <button id="btnToShip" class="btn hidden">出荷予定</button>
    <button id="btnToFinPage" class="btn hidden">完成品一覧</button>
    <button id="btnToInvPage" class="btn hidden">在庫</button>
    <button id="btnToInvoice" class="btn hidden">請求書</button>
    <button id="btnToCharts" class="btn hidden">分析チャート</button>
    <div class="grow"></div>
    <button id="btnStationQR" class="btn">工程QR</button>
    <button id="ddSetting" class="btn hidden">設定</button>
  </nav>

  <!-- ========= Pages ========= -->
  <main>
    <!-- Auth -->
    <section id="authView" class="card section">
      <h3>ログイン</h3>
      <div class="row" style="max-width:520px">
        <input id="inUser" class="chip" placeholder="ユーザー名" style="flex:1;min-width:180px" />
        <input id="inPass" class="chip" type="password" placeholder="パスワード" style="flex:1;min-width:180px" />
        <button id="btnLogin" class="chip primary">ログイン</button>
      </div>
      <p class="s">※ 上部メニューはログイン後に表示されます。</p>
    </section>

    <!-- Dash -->
    <section id="pageDash" class="card section hidden">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="row">
          <input id="searchQ" class="chip" placeholder="検索..." />
          <button id="btnExportOrders" class="chip">Export</button>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>注番</th><th>品名</th><th>品番</th><th>図番</th>
              <th>状態</th><th>工程/OK/NG</th><th>更新日</th><th>更新者</th><th>操作</th>
            </tr>
          </thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>

      <div class="row" style="margin-top:12px">
        <div class="card section" style="flex:1;min-width:280px">
          <h4>本日出荷</h4>
          <div id="shipToday" class="s">—</div>
        </div>
        <div class="card section" style="flex:1;min-width:280px">
          <h4>出荷予定</h4>
          <div id="shipPlan" class="s">—</div>
        </div>
      </div>
    </section>

    <!-- Sales -->
    <section id="pageSales" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <input id="salesSearch" class="chip" placeholder="検索..." />
          <button id="btnSalesCreate" class="chip">作成</button>
        </div>
        <div class="row">
          <button id="btnSalesImport" class="chip">Import</button>
          <button id="btnSalesExport" class="chip">Export</button>
          <button id="btnSalesPrint" class="chip">Print</button>
          <button id="btnSalesTpl" class="chip">ひな形CSV</button>
        </div>
      </div>
      <div class="table-wrap" style="margin-top:10px">
        <table>
          <thead id="thSales"></thead>
          <tbody id="tbSales"></tbody>
        </table>
      </div>
    </section>

    <!-- Plan -->
    <section id="pagePlan" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <input id="planSearch" class="chip" placeholder="検索..." />
          <button id="btnPlanCreate" class="chip">作成</button>
        </div>
        <div class="row">
          <button id="btnPlanImport" class="chip">Import</button>
          <button id="btnPlanExport" class="chip">Export</button>
          <button id="btnPlanPrint" class="chip">Print</button>
          <button id="btnPlanTpl" class="chip">ひな形CSV</button>
        </div>
      </div>
      <div class="table-wrap" style="margin-top:10px">
        <table>
          <thead id="thPlan"></thead>
          <tbody id="tbPlan"></tbody>
        </table>
      </div>
    </section>

    <!-- Ship -->
    <section id="pageShip" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <input id="shipSearch" class="chip" placeholder="検索..." />
          <button id="btnShipCreate" class="chip">作成</button>
        </div>
        <div class="row">
          <button id="btnShipImport" class="chip">Import</button>
          <button id="btnShipExport" class="chip">Export</button>
          <button id="btnShipPrint" class="chip">Print</button>
          <button id="btnShipTpl" class="chip">ひな形CSV</button>
        </div>
      </div>
      <div class="table-wrap" style="margin-top:10px">
        <table>
          <thead id="thShip"></thead>
          <tbody id="tbShip"></tbody>
        </table>
      </div>
    </section>

    <!-- Finished -->
    <section id="pageFinished" class="card section hidden">
      <div class="row" style="justify-content:flex-end">
        <button id="btnFinExport" class="chip">Export</button>
        <button id="btnFinPrint" class="chip">Print</button>
      </div>
      <div class="table-wrap">
        <table>
          <thead id="thFin"></thead>
          <tbody id="tbFin"></tbody>
        </table>
      </div>
    </section>

    <!-- Inventory -->
    <section id="pageInv" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <input id="invSearch" class="chip" placeholder="検索..." />
        <div class="row">
          <button id="btnInvExport" class="chip">Export</button>
          <button id="btnInvPrint" class="chip">Print</button>
        </div>
      </div>
      <div class="table-wrap" style="margin-top:10px">
        <table>
          <thead id="thInv"></thead>
          <tbody id="tbInv"></tbody>
        </table>
      </div>
    </section>

    <!-- 請求書 -->
    <section id="pageInvoice" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <select id="invCustSel" class="chip"><option value="">（得意先を選択）</option></select>
          <input id="invIssueDate" type="date" class="chip" />
        </div>
        <div class="row">
          <button id="invRefresh" class="chip">更新</button>
          <button id="invSave" class="chip primary">保存</button>
          <button id="invPdf" class="chip">PDF出力</button>
          <button id="invExcel" class="chip">Excel出力</button>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <div class="card section" style="flex:1 1 420px">
          <h4>未（候補）</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>選択</th><th>注番</th><th>商品名</th><th>品番</th><th>数量</th><th>単価</th><th>金額</th><th>出荷日</th></tr>
              </thead>
              <tbody id="tbInvCandidates"></tbody>
            </table>
          </div>
        </div>

        <div class="card section" style="flex:1 1 420px">
          <h4>得意先内 全件（ステータス）</h4>
          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>注番</th><th>商品名</th><th>品番</th><th>数量</th><th>単価</th><th>金額</th><th>出荷日</th><th>状態</th></tr>
              </thead>
              <tbody id="tbInvStatus"></tbody>
            </table>
          </div>
        </div>
      </div>

      <h4 style="margin-top:14px">請求書一覧</h4>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>請求書番号</th><th>得意先</th><th>発行日</th><th>合計</th><th>ファイル名</th><th>作成者</th></tr>
          </thead>
          <tbody id="tbInvoiceList"></tbody>
        </table>
      </div>
    </section>

    <!-- 分析チャート -->
    <section id="pageCharts" class="card section hidden">
      <div class="row" style="justify-content:space-between">
        <div class="row">
          <button class="chip" data-range="ytd">年内</button>
          <button class="chip" data-range="30d">30日</button>
          <button class="chip" data-range="14d">14日</button>
          <span class="s">メトリクス:</span>
          <button class="chip" data-metric="qty">数量</button>
          <button class="chip" data-metric="count">件数</button>
        </div>
        <div class="row">
          <button id="chExportExcel" class="chip">Excel</button>
          <button id="chExportPdf" class="chip">PDF</button>
        </div>
      </div>

      <div class="row" style="margin-top:10px;gap:12px;flex-wrap:wrap">
        <div class="card section" style="flex:1 1 480px;min-width:320px">
          <h4>出荷（日次）</h4>
          <canvas id="chDaily" height="240"></canvas>
        </div>
        <div class="card section" style="flex:1 1 480px;min-width:320px">
          <h4>出荷（月次・YTD）</h4>
          <canvas id="chMonthly" height="240"></canvas>
        </div>
        <div class="card section" style="flex:1 1 480px;min-width:320px">
          <h4>顧客別 出荷（Top）</h4>
          <canvas id="chCustTop" height="300"></canvas>
        </div>
        <div class="card section" style="flex:1 1 480px;min-width:320px">
          <h4>顧客別 月次 出荷</h4>
          <canvas id="chCustMonthly" height="300"></canvas>
        </div>
      </div>
    </section>

    <div class="spacer"></div>
  </main>

  <!-- ========= 共通ダイアログ ========= -->
  <!-- 操作（手入力） -->
  <dialog id="dlgOp" class="dlg">
    <h3 id="opPO">PO</h3>
    <div class="row">
      <select id="opProcess" class="chip"></select>
      <input id="opOK" class="chip" type="number" min="0" placeholder="OK" style="width:120px" />
      <input id="opNG" class="chip" type="number" min="0" placeholder="NG" style="width:120px" />
      <input id="opNote" class="chip" placeholder="備考" style="flex:1" />
    </div>
    <div class="row" style="justify-content:flex-end;margin-top:10px">
      <button id="btnOpCancel" class="chip">キャンセル</button>
      <button id="btnOpSave" class="chip primary">保存</button>
    </div>
  </dialog>

  <!-- スキャン -->
  <dialog id="dlgScan" class="dlg">
    <h3 id="scanResult" class="s">—</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
      <video id="scanVideo" style="width:100%;border:1px solid var(--border);border-radius:10px"></video>
      <canvas id="scanCanvas" style="width:100%;border:1px solid var(--border);border-radius:10px"></canvas>
    </div>
    <div class="row" style="justify-content:flex-end;margin-top:10px">
      <button id="btnScanStart" class="chip primary">開始</button>
      <button id="btnScanClose" class="chip">閉じる</button>
    </div>
  </dialog>

  <!-- フォーム（受注/計画/出荷） -->
  <dialog id="dlgForm" class="dlg" style="max-width:680px">
    <h3 id="dlgTitle">編集</h3>
    <form id="formBody" method="dialog"></form>
    <div class="row" style="justify-content:flex-end;margin-top:10px">
      <button id="btnDlgCancel" class="chip">キャンセル</button>
      <button id="btnDlgSave" class="chip primary">保存</button>
    </div>
  </dialog>

  <!-- ========= ライブラリ ========= -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

  <!-- ========= アプリ本体 ========= -->
  <script src="./app.js"></script>
</body>
</html>
