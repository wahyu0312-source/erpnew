<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>東京都精密機械株式会社システム</title>

  <!-- Styles dasar (ringkas) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/2.0.0/modern-normalize.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --surface:#ffffff; --bg:#f6f7fb;
      --border:#e5e7eb; --accent:#0ea5a8; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,"Noto Sans JP","Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
    .hidden{display:none !important;}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border);}
    .topwrap{display:flex;align-items:center;gap:10px;height:56px;padding:0 14px;}
    .brand{font-weight:800}
    .nav{display:flex;gap:10px;margin-left:auto;}
    .chipbtn{display:inline-flex;align-items:center;gap:.5rem;border:1px solid var(--border);background:#fff;border-radius:999px;height:34px;padding:0 12px;cursor:pointer}
    .chipbtn.hidden{display:none}

    /* Page containers */
    .container{max-width:1280px;margin:18px auto;padding:0 14px;}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 10px 30px rgba(15,23,42,.05);padding:14px;}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .row-between{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:980px){ .grid2{grid-template-columns:1fr} }

    /* Table (yang lama tetap) */
    .table-wrap{overflow:auto;border-radius:12px;border:1px solid var(--border);}
    table{width:100%;border-collapse:collapse;background:#fff}
    th,td{border-bottom:1px solid var(--border);padding:8px 10px;text-align:left}
    th{background:#f8fafc;font-weight:600}

    /* Charts */
    .chart-panel{padding:10px}
    .chart-toolbar{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
    .chart-box{height:340px}
    .chart-box.tall{height:380px}
    .select{height:32px;border:1px solid var(--border);border-radius:8px;background:#fff;padding:0 8px}
  </style>

  <!-- Vendor utk chart & export -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2"></script>
</head>
<body>

  <!-- ====== TOP BAR ====== -->
  <div class="topbar">
    <div class="topwrap">
      <div class="brand">東京都精密機械株式会社システム</div>

      <!-- tombol navigasi (yang lama tetap) -->
      <div class="nav">
        <button id="btnToDash" class="chipbtn"><i class="fa-solid fa-gauge"></i> ダッシュボード</button>
        <button id="btnToSales" class="chipbtn"><i class="fa-regular fa-file-lines"></i> 受注</button>
        <button id="btnToPlan" class="chipbtn"><i class="fa-solid fa-list-check"></i> 生産計画</button>
        <button id="btnToShip" class="chipbtn"><i class="fa-solid fa-truck-ramp-box"></i> 出荷予定</button>
        <button id="btnToFinPage" class="chipbtn"><i class="fa-regular fa-circle-check"></i> 完成品一覧</button>
        <button id="btnToInvPage" class="chipbtn"><i class="fa-solid fa-warehouse"></i> 在庫</button>
        <button id="btnToInvoice" class="chipbtn"><i class="fa-regular fa-file-invoice"></i> 請求書</button>

        <!-- 🔥 MENU BARU: 分析チャート -->
        <button id="btnToCharts" class="chipbtn"><i class="fa-solid fa-chart-line"></i> 分析チャート</button>

        <div class="chipbtn" id="ddSetting"><i class="fa-solid fa-gear"></i> 設定</div>
        <div class="chipbtn" id="btnLogout"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</div>
      </div>
    </div>
  </div>

  <!-- =========== AUTH VIEW (tetap) =========== -->
  <div id="authView" class="container">
    <div class="card" style="max-width:520px;margin:100px auto">
      <h3 style="margin:6px 0 14px">ログイン</h3>
      <div style="display:grid;gap:8px">
        <input id="inUser" class="select" placeholder="ユーザー名">
        <input id="inPass" class="select" placeholder="パスワード" type="password">
        <button id="btnLogin" class="chipbtn" style="justify-content:center"><i class="fa-solid fa-right-to-bracket"></i> ログイン</button>
        <div class="muted" style="color:var(--muted);font-size:12px">※ 上部メニューはログイン後に表示されます。</div>
      </div>
    </div>
  </div>

  <!-- =========== PAGE: DASHBOARD / SALES / PLAN / SHIP / FIN / INV (yang lama) =========== -->
  <div id="pageDash" class="container hidden"></div>
  <div id="pageSales" class="container hidden"></div>
  <div id="pagePlan" class="container hidden"></div>
  <div id="pageShip" class="container hidden"></div>
  <div id="pageFinished" class="container hidden"></div>
  <div id="pageInv" class="container hidden"></div>

  <!-- =========== PAGE: 請求書 (yang sudah kamu tambahkan sebelumnya) =========== -->
  <div id="pageInvoice" class="container hidden"></div>

  <!-- =========== 🔥 PAGE BARU: 分析チャート =========== -->
  <div id="pageCharts" class="container hidden">
    <!-- Filter bar -->
    <div class="card">
      <div class="row">
        <div class="row">
          <label>年:</label>
          <select id="chYear" class="select"></select>
          <label>月:</label>
          <select id="chMonth" class="select">
            <option value="">(全て)</option>
            <option value="1">1月</option><option value="2">2月</option><option value="3">3月</option>
            <option value="4">4月</option><option value="5">5月</option><option value="6">6月</option>
            <option value="7">7月</option><option value="8">8月</option><option value="9">9月</option>
            <option value="10">10月</option><option value="11">11月</option><option value="12">12月</option>
          </select>
          <label>得意先:</label>
          <select id="chCust" class="select"><option value="">(全て)</option></select>
        </div>
        <div class="row" style="margin-left:auto">
          <button id="chReload" class="chipbtn"><i class="fa-solid fa-rotate"></i> 更新</button>
          <button id="chExportImg" class="chipbtn"><i class="fa-regular fa-image"></i> PNG出力</button>
          <button id="chExportXlsx" class="chipbtn"><i class="fa-regular fa-file-excel"></i> Excel出力</button>
        </div>
      </div>
    </div>

    <!-- Grid charts -->
    <div class="grid2" style="margin-top:12px">
      <div class="card chart-panel">
        <div class="chart-toolbar"><strong>出荷（日次）</strong></div>
        <div class="chart-box"><canvas id="cDaily"></canvas></div>
      </div>

      <div class="card chart-panel">
        <div class="chart-toolbar"><strong>出荷（月次・年内）</strong></div>
        <div class="chart-box"><canvas id="cMonthly"></canvas></div>
      </div>

      <div class="card chart-panel">
        <div class="chart-toolbar"><strong>顧客別 出荷（Top 10）</strong></div>
        <div class="chart-box tall"><canvas id="cTopCust"></canvas></div>
      </div>

      <div class="card chart-panel">
        <div class="chart-toolbar"><strong>顧客別 月次/年次（Stacked / Pareto / Pie）</strong>
          <select id="chMode" class="select">
            <option value="month">月</option>
            <option value="year">年</option>
          </select>
          <select id="chType" class="select">
            <option value="stacked">Stacked</option>
            <option value="pareto">Pareto</option>
            <option value="pie">Pie</option>
          </select>
          <select id="chPick" class="select"><!-- diisi dinamis --></select>
        </div>
        <div class="chart-box tall"><canvas id="cCustMonthly"></canvas></div>
      </div>
    </div>
  </div>

  <!-- App -->
  <script src="./app.js"></script>
</body>
</html>
