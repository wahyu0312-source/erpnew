<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ERP Mini</title>
  <link rel="icon" href="assets/logo.png">
  <link rel="stylesheet" href="style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Supabase JS v2 -->
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <nav class="nav">
    <div class="nav-left">
      <img id="logoImg" src="assets/logo.png" class="logo" alt="Logo">
      <span class="brand">ERP Mini</span>
    </div>
    <div class="nav-right">
      <span id="userInfo" class="muted"></span>
      <button id="btnLogout" class="btn ghost">Logout</button>
    </div>
  </nav>

  <!-- AUTH -->
  <main id="authView" class="container">
    <section class="card card-tight">
      <h2>Masuk</h2>
      <div class="grid">
        <label>Email
          <input id="inEmail" type="email" autocomplete="email">
        </label>
        <label>Password
          <input id="inPass" type="password" autocomplete="current-password">
        </label>
      </div>
      <div class="row gap">
        <button id="btnLogin" class="btn primary grow">Login</button>
        <button id="btnSignup" class="btn ghost grow">Sign Up</button>
      </div>
      <p class="muted s">Setelah Sign Up, isi profile di tabel <code>profiles</code> (full_name, department) lewat Supabase.</p>
    </section>
  </main>

  <!-- APP -->
  <main id="appView" class="container hidden">
    <section class="grid-2">
      <div>
        <section class="card">
          <header class="row-between">
            <h3>Dashboard</h3>
            <div class="row gap">
              <button class="btn ghost" id="btnRefresh">Refresh</button>
              <button class="btn ghost" onclick="window.print()">Print</button>
            </div>
          </header>

          <div class="grid-3">
            <div class="stat">
              <div class="muted s">Stok Barang Jadi</div>
              <div id="statFinished" class="stat-num">-</div>
              <div class="muted s"><span id="statReady">-</span> ready • <span id="statShipped">-</span> shipped</div>
            </div>
            <div class="tile">
              <div class="muted s">Rencana Pengiriman (Hari Ini)</div>
              <div id="listToday" class="list s"></div>
            </div>
            <div class="tile">
              <div class="muted s">Lokasi Barang (per proses)</div>
              <div id="gridProc" class="grid grid-chips"></div>
            </div>
          </div>
        </section>

        <section class="card">
          <header class="row-between">
            <h3>Daftar Order</h3>
            <div class="row gap">
              <input id="searchQ" placeholder="Cari ..." class="input">
              <button class="btn ghost" id="btnExportOrders">Export Orders CSV</button>
              <button class="btn ghost" id="btnExportShip">Export Shipments CSV</button>
            </div>
          </header>
          <div class="table-wrap">
            <table class="table s">
              <thead>
                <tr>
                  <th>PO</th><th>得意先</th><th>製番号</th><th>品名</th><th>品番</th><th>図番</th>
                  <th>Status</th><th>Process</th><th>Updated</th><th>By</th><th>Aksi</th>
                </tr>
              </thead>
              <tbody id="tbOrders"></tbody>
            </table>
          </div>
        </section>
      </div>

      <div>
        <section class="card">
          <h3>Rencana Produksi Baru</h3>
          <div class="grid">
            <input id="c_tsuchi" placeholder="通知書番号 (opsional)">
            <input id="c_tokui" placeholder="得意先" list="dl_tokui">
            <input id="c_tokui_hin" placeholder="得意先品番">
            <input id="c_sei" placeholder="製番号">
            <input id="c_hinmei" placeholder="品名" list="dl_hinmei">
            <input id="c_hinban" placeholder="品番" list="dl_hinban">
            <input id="c_zuban" placeholder="図番" list="dl_zuban">
            <input id="c_kanri" placeholder="管理No (opsional)">
          </div>
          <datalist id="dl_tokui"></datalist>
          <datalist id="dl_hinmei"></datalist>
          <datalist id="dl_hinban"></datalist>
          <datalist id="dl_zuban"></datalist>
          <button id="btnCreateOrder" class="btn primary full">生産現品票 発行</button>
        </section>

        <section class="card">
          <h3>Rencana Pengiriman</h3>
          <div class="grid">
            <input id="s_po" placeholder="PO ID">
            <input id="s_date" type="date">
            <input id="s_qty" type="number" min="0" placeholder="Qty">
          </div>
          <div class="row gap">
            <button id="btnSchedule" class="btn primary grow">Jadwalkan</button>
            <button id="btnShipByPO" class="btn ghost grow">出荷確認書（PO）</button>
            <button id="btnShipByID" class="btn ghost grow">出荷確認書（Ship ID）</button>
          </div>
        </section>

        <section class="card">
          <h3>Charts</h3>
          <canvas id="chartMonthly" height="160"></canvas>
          <hr>
          <canvas id="chartCustomer" height="160"></canvas>
          <hr>
          <canvas id="chartStock" height="160"></canvas>
        </section>
      </div>
    </section>
  </main>

  <!-- MODALS -->
  <dialog id="dlgTicket" class="paper">
    <div id="ticketBody"></div>
    <footer class="row-end">
      <button class="btn ghost" onclick="window.print()">Print</button>
      <button class="btn" onclick="document.getElementById('dlgTicket').close()">Tutup</button>
    </footer>
  </dialog>

  <dialog id="dlgShip" class="paper">
    <div id="shipBody"></div>
    <footer class="row-end">
      <button class="btn ghost" onclick="window.print()">Print</button>
      <button class="btn" onclick="document.getElementById('dlgShip').close()">Tutup</button>
    </footer>
  </dialog>
</body>
</html>
