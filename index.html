<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="assets/tsh.png">

  <!-- Font Awesome (tanpa integrity agar tidak ke-block SRI mismatch) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="stylesheet" href="style.css">

  <!-- Charts & QR & SheetJS -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- Konfigurasi URL GAS untuk seluruh app -->
  <script>
    window.GAS_URL = 'YOUR_DEPLOYED_WEB_APP_URL'; /* <-- GANTI di sini */
  </script>
  <script defer src="app.js"></script>
</head>
<body>
  <nav class="nav">
    <div class="nav-left"><img src="assets/tsh.png" class="logo" alt=""><span class="brand">東京精密発條株式会社システム</span></div>
    <div class="nav-right">
      <button id="btnToDash" class="btn ghost hidden"><i class="fa-solid fa-gauge"></i> ダッシュボード</button>
      <details class="dropdown-inline hidden" id="ddSetting">
        <summary class="btn ghost"><i class="fa-solid fa-gear"></i> 設定 <i class="fa-solid fa-caret-down caret" style="margin-left:.25rem"></i></summary>
        <div class="menu right">
          <button id="miAddUser" class="menu-item"><i class="fa-solid fa-user-plus"></i> ユーザー追加</button>
          <button id="miChangePass" class="menu-item"><i class="fa-solid fa-key"></i> パス変更</button>
          <hr style="border:none;border-top:1px solid var(--border);margin:.35rem 0">
          <button id="btnLogout" class="menu-item"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
        </div>
      </details>
      <span id="userInfo" class="muted"></span>
    </div>
  </nav>

  <!-- AUTH -->
  <main id="authView" class="container">
    <section class="card card-tight">
      <h2><i class="fa-solid fa-right-to-bracket"></i> ログイン</h2>
      <div class="grid">
        <input id="inUser" placeholder="ユーザー名" autocomplete="username">
        <input id="inPass" type="password" placeholder="パスワード" autocomplete="current-password">
      </div>
      <details class="card" style="margin-top:.8rem">
        <summary><strong><i class="fa-solid fa-user-gear"></i> 管理者: ユーザー追加</strong></summary>
        <div class="grid" style="margin-top:.6rem">
          <input id="nuUser" placeholder="ユーザー名">
          <input id="nuPass" type="password" placeholder="パスワード">
          <input id="nuName" placeholder="氏名">
          <select id="nuDept"><option value="営業">営業</option><option value="生産技術">生産技術</option><option value="生産管理部">生産管理部</option><option value="製造部">製造部</option><option value="検査部">検査部</option></select>
          <select id="nuRole"><option value="member">member</option><option value="manager">manager</option><option value="admin">admin</option></select>
        </div>
        <button id="btnNewUser" class="btn ghost full">ユーザー追加</button>
        <p class="muted s">初回: <code>admin / admin123</code>（Users空なら自動作成）</p>
      </details>
      <button id="btnLogin" class="btn primary full" style="margin-top:.8rem">ログイン</button>
    </section>
  </main>

  <!-- DASHBOARD (placeholder minimal) -->
  <main id="pageDash" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-gauge"></i> ダッシュボード</h3>
        <div class="row gap"><button class="btn ghost" id="btnRefresh"><i class="fa-solid fa-rotate"></i> 更新</button></div>
      </header>
      <div id="dashMsg" class="muted">ログインしました。</div>
    </section>
  </main>

  <script>
    // register SW (optional)
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
