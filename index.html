<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="assets/tsh.png">

  <!-- Font Awesome (tanpa integrity agar tidak diblok Edge/CDN mismatch) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- App styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <!-- App -->
  <script defer src="app.js"></script>

  <!-- (Opsional) styling kecil untuk weather pill -->
  <style>
    .wx-pill{display:inline-flex;align-items:center;gap:.6rem;padding:.5rem .8rem;border-radius:999px;border:1px solid rgba(0,0,0,.08);background:linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);color:#0f172a; box-shadow:0 6px 18px rgba(2,6,23,.08), inset 0 1px 0 #fff;min-height:40px; max-width:60vw;}
    .wx-city{font-size:.9rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .wx-temp{font-weight:900;letter-spacing:.02em}
    .wx-ico{width:22px;height:22px;display:inline-block}
    .wx-dot{width:6px;height:6px;border-radius:50%;background:#93c5fd;opacity:.9}
    @media (max-width:760px){ .wx-pill{order:-1} }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-left">
      <img src="assets/tsh.png" class="logo" alt="">
      <span class="brand">東京精密発條株式会社システム</span>
    </div>
    <div id="weather" class="wx-pill" title="現在の天気">
      <span id="wxCity" class="wx-city">取得中…</span>
      <span class="wx-dot"></span>
      <span id="wxIcon" class="wx-ico"></span>
      <span id="wxTemp" class="wx-temp">--℃</span>
    </div>
    <div class="nav-right">
      <button id="btnToDash" class="btn ghost hidden"><i class="fa-solid fa-gauge"></i> ダッシュボード</button>
      <button id="btnToPlan" class="btn ghost hidden"><i class="fa-solid fa-list-check"></i> 生産現品票</button>
      <button id="btnToShip" class="btn ghost hidden"><i class="fa-solid fa-truck"></i> 出荷予定</button>
      <button id="btnToCharts" class="btn ghost hidden"><i class="fa-solid fa-chart-simple"></i> 統計</button>
      <button id="btnLogout" class="btn ghost hidden"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
      <span id="userInfo" class="muted"></span>
    </div>
  </nav>

  <!-- LOGIN -->
  <main id="authView" class="container">
    <section class="card" style="max-width:520px;margin:2rem auto">
      <header><h3><i class="fa-solid fa-right-to-bracket"></i> ログイン</h3></header>
      <div class="grid">
        <input id="inUser" placeholder="ユーザーID">
        <input id="inPass" placeholder="パスワード" type="password">
        <label class="row-start"><input id="inRemember" type="checkbox"> <span>ログイン状態を保持</span></label>
        <button id="btnLogin" class="btn primary">ログイン</button>
      </div>
    </section>
  </main>

  <!-- DASHBOARD -->
  <main id="pageDash" class="container hidden">
    <header class="row-between">
      <h2><i class="fa-solid fa-gauge"></i> 生産ダッシュボード</h2>
      <div class="row gap">
        <button id="btnOpenScan" class="btn"><i class="fa-solid fa-qrcode"></i> スキャン</button>
      </div>
    </header>

    <section class="grid-2">
      <div class="tile">
        <div class="muted s">当日スナップショット</div>
        <div class="row-around big">
          <div><strong id="ssTickets">0</strong><div class="muted s">現品票（件）</div></div>
          <div><strong id="ssDone">0</strong><div class="muted s">完了（件）</div></div>
          <div><strong id="ssOk">0</strong><div class="muted s">OK品（個）</div></div>
          <div><strong id="ssNg">0</strong><div class="muted s">不良品（個）</div></div>
        </div>
      </div>
      <div class="tile">
        <div class="muted s">工程別 不良品</div>
        <div style="height:240px"><canvas id="chDefectByProc"></canvas></div>
      </div>
    </section>
  </main>

  <!-- 生産現品票（入力 cepat minimal untuk demo） -->
  <main id="pagePlan" class="container hidden">
    <header><h3><i class="fa-solid fa-list-check"></i> 生産現品票</h3></header>
    <section class="card">
      <div class="grid">
        <input id="c_po" placeholder="注番（編集用）">
        <input id="c_tokui" placeholder="得意先">
        <input id="c_zuban" placeholder="図番">
        <input id="c_kishu" placeholder="機種（=品番）">
        <input id="c_hinmei" placeholder="商品名（=品名）">
        <input id="c_qty" type="number" min="0" placeholder="数量">
        <input id="c_biko" placeholder="備考">
        <button id="btnCreateOrder" class="btn">登録/更新</button>
      </div>
    </section>

    <section class="card">
      <header class="row-between">
        <h4>現品票一覧</h4>
        <input id="qOrders" class="input" placeholder="検索…">
      </header>
      <div id="tblOrders" class="table"></div>
    </section>
  </main>

  <!-- 出荷予定（minimal） -->
  <main id="pageShip" class="container hidden">
    <header><h3><i class="fa-solid fa-truck"></i> 出荷予定</h3></header>
    <section class="card">
      <div class="grid">
        <input id="s_po" placeholder="注番">
        <input id="s_date" type="date" placeholder="出荷日">
        <input id="s_qty"  type="number" min="0" placeholder="数量">
        <input id="s_dest" placeholder="送り先">
        <input id="s_cust" placeholder="得意先">
        <input id="s_note" placeholder="備考">
        <button id="btnSchedule" class="btn">登録</button>
      </div>
    </section>
  </main>

  <!-- 統計 -->
  <main id="pageCharts" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-chart-simple"></i> 統計</h3>
        <button id="btnChartsRefresh" class="btn ghost"><i class="fa-solid fa-rotate"></i> 更新</button>
      </header>
      <div class="grid-3">
        <div class="tile"><div class="muted s">工程内WIP</div><div style="height:220px"><canvas id="chWipProc"></canvas></div></div>
        <div class="tile"><div class="muted s">営業 受注数</div><div style="height:220px"><canvas id="chSales"></canvas></div></div>
        <div class="tile"><div class="muted s">生産計画 作成数</div><div style="height:220px"><canvas id="chPlan"></canvas></div></div>
      </div>
      <div class="grid-3" style="margin-top:1rem">
        <div class="tile"><div class="muted s">不良品（工程別）</div><div style="height:220px"><canvas id="chDefects"></canvas></div></div>
      </div>
    </section>
  </main>

  <!-- Dialog: Scan QR + OK/NG -->
  <dialog id="dlgScan" class="paper">
    <div class="body">
      <h3>QRスキャン更新（PO: <span id="scanPO"></span>）</h3>
      <video id="scanVideo" playsinline></video>
      <canvas id="scanCanvas" class="hidden"></canvas>
      <div class="grid" style="margin-top:.5rem">
        <input id="inOkQty" type="number" min="0" placeholder="OK品 数量">
        <input id="inNgQty" type="number" min="0" placeholder="不良品 数量">
        <input id="inNote" placeholder="メモ/備考（任意）">
      </div>
      <div id="scanResult" class="muted s" style="margin-top:.5rem"></div>
    </div>
    <footer class="row-end">
      <button id="btnScanStart" class="btn ghost">開始</button>
      <button id="btnScanClose" class="btn">閉じる</button>
    </footer>
  </dialog>

  <!-- Dialog kecil: Ticket detail (opsional, bisa diisi nanti) -->

</body>
</html>
