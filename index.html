<!doctype html>
<html lang="ja" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>生産ダッシュボード</title>
  <link rel="icon" href="favicon.ico" />
  <!-- Tailwind (CDN, no build) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50:'#f5f8ff',100:'#e9f0ff',200:'#cfe0ff',300:'#aecdff',400:'#7bb0ff',500:'#4b93ff',600:'#2f78eb',700:'#225ec0',800:'#1d4a95',900:'#1b3e78' },
          },
          fontFamily: { display:["Inter","ui-sans-serif","system-ui"], body:["Inter","ui-sans-serif","system-ui"] },
          boxShadow: { soft:"0 10px 30px rgba(0,0,0,.08)" }
        }
      }
    };
  </script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- QRCode -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-wzV3v5cYhGkW0l4iQL8f7o3n9nuvzkR9MWV0YfEJb2c8JtJV2k8bJt9oX2mZqQ0lq0lA3X8J9WmQpLxq4h+Jqg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- PapaParse for CSV import/export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha512-yJ14lO8s2Tn4eG5Sg1F3g7Dk88K6j4w2oS6Dqf6GdKzM1mBv7n3n1cFhZqJQ9m2+q2oV2eJcR1o5+9bZCkqSpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />
  <style>
    @media print { @page { size: A4 portrait; margin: 12mm; } }
  </style>
</head>
<body class="h-full bg-gradient-to-b from-brand-50 to-white text-gray-900 font-body">
  <!-- App Shell -->
  <div id="app" class="min-h-screen grid grid-rows-[auto,1fr]">
    <!-- Topbar -->
    <header class="sticky top-0 z-40 backdrop-blur bg-white/70 border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-3 flex items-center gap-3">
        <img src="./logo.png" class="w-8 h-8" alt="logo"/>
        <h1 class="text-lg sm:text-xl font-semibold tracking-tight">東京精密発條 — 生産ダッシュボード</h1>
        <div class="ml-auto flex items-center gap-2">
          <span id="roleBadge" class="hidden px-2 py-1 text-xs rounded-full bg-brand-100 text-brand-800"></span>
          <button id="btnPrint" class="btn-secondary hidden print:hidden" title="Print A4"><i data-lucide="printer"></i><span class="hidden sm:inline">Print</span></button>
        </div>
      </div>
    </header>

    <!-- Main -->
    <main class="max-w-7xl w-full mx-auto px-3 sm:px-6 lg:px-8 py-4">
      <!-- Login Card (Menus hidden until login) -->
      <section id="loginSection" class="max-w-md mx-auto">
        <div class="card">
          <h2 class="card-title">ログイン</h2>
          <p class="text-sm text-gray-600 mb-4">ロールを選択し、アクセスPINを入力してください。</p>
          <div class="grid gap-3">
            <label class="block">
              <span class="text-sm">ロール</span>
              <select id="role" class="input">
                <option value="営業">営業（受注・請求書）</option>
                <option value="生産管理">生産管理（生産計画・出荷予定・出荷準備・在庫管理）</option>
                <option value="製造">製造（準備→組立済）</option>
                <option value="検査">検査（検査工程）</option>
                <option value="Admin">Admin（全て）</option>
              </select>
            </label>
            <label class="block">
              <span class="text-sm">PIN</span>
              <input id="pin" type="password" class="input" placeholder="****" />
            </label>
            <button id="btnLogin" class="btn-primary">ログイン</button>
          </div>
        </div>
      </section>

      <!-- Tabs -->
      <section id="appSection" class="hidden">
        <div class="tabs">
          <button data-tab="orders" class="tab active">受注</button>
          <button data-tab="plan" class="tab">生産計画</button>
          <button data-tab="ship" class="tab">出荷予定</button>
          <button data-tab="board" class="tab">オーダー一覧</button>
          <button data-tab="qr" class="tab">工程QR</button>
        </div>

        <!-- Toolbar (CRUD + Import/Export/Save/Print) -->
        <div class="toolbar print:hidden">
          <button class="btn-primary" data-action="create"><i data-lucide="plus"></i>作成</button>
          <button class="btn-secondary" data-action="import"><i data-lucide="upload"></i>Import</button>
          <button class="btn-secondary" data-action="export"><i data-lucide="download"></i>Export</button>
          <button class="btn-secondary" data-action="save"><i data-lucide="save"></i>保存</button>
          <button class="btn-secondary" data-action="print"><i data-lucide="printer"></i>Print</button>
          <input id="fileImport" type="file" accept=".csv" class="hidden" />
        </div>

        <!-- Tab Panels -->
        <div id="panel-orders" class="panel">
          <h3 class="panel-title">受注</h3>
          <div id="ordersTable" class="data-table"></div>
        </div>

        <div id="panel-plan" class="panel hidden">
          <h3 class="panel-title">生産計画</h3>
          <div id="planTable" class="data-table"></div>
        </div>

        <div id="panel-ship" class="panel hidden">
          <h3 class="panel-title">出荷予定</h3>
          <div id="shipTable" class="data-table"></div>
        </div>

        <div id="panel-board" class="panel hidden">
          <h3 class="panel-title">オーダー一覧</h3>
          <div class="mb-3 text-sm text-gray-600">スマホ〜4Kまでフィット。横スクロール抑制・カラム折返し採用。</div>
          <div id="boardTable" class="data-table"></div>
        </div>

        <div id="panel-qr" class="panel hidden">
          <h3 class="panel-title">工程QR</h3>
          <p class="text-sm text-gray-600 mb-2">各工程のQRを生成・印刷（A4最適化）。「外注加工/組立」ラベルに統一。</p>
          <div id="qrGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
        </div>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
  <script>
    window.addEventListener('load', () => {
      if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
      lucide.createIcons();
    });
  </script>
</body>
</html>
