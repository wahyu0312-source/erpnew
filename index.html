<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="./assets/tsh.png">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="./style.css">

  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <script defer src="./app.js"></script>
</head>
<body>
  <nav class="nav">
    <div class="nav-left">
      <img src="./assets/tsh.png" class="logo" alt="">
      <span class="brand">東京精密発條株式会社システム</span>
    </div>
    <div id="weather" class="wx-pill" aria-live="polite">
      <span id="wxCity" class="wx-city">取得中…</span>
      <span class="wx-dot" aria-hidden="true"></span>
      <span id="wxIcon" class="wx-ico" aria-hidden="true"></span>
      <span id="wxTemp" class="wx-temp">--℃</span>
    </div>
    <div class="nav-right">
      <button id="btnToDash" class="btn ghost hidden"><i class="fa-solid fa-gauge"></i> ダッシュボード</button>
      <button id="btnToSales" class="btn ghost hidden"><i class="fa-regular fa-handshake"></i> 受注</button>
      <button id="btnToPlan"  class="btn ghost hidden"><i class="fa-solid fa-list-check"></i> 生産計画</button>
      <button id="btnToShip"  class="btn ghost hidden"><i class="fa-solid fa-truck"></i> 出荷予定</button>
      <button id="btnToInvPage" class="btn ghost hidden"><i class="fa-solid fa-boxes-stacked"></i> 在庫</button>
      <button id="btnToFinPage" class="btn ghost hidden"><i class="fa-regular fa-square-check"></i> 完成品一覧</button>
      <button id="btnToInvoice" class="btn ghost hidden"><i class="fa-regular fa-file-lines"></i> 請求書</button>
      <button id="btnToCharts" class="btn ghost hidden"><i class="fa-solid fa-chart-simple"></i> 統計</button>
      <details class="dropdown-inline hidden" id="ddSetting">
        <summary class="btn ghost"><i class="fa-solid fa-gear"></i> 設定 <i class="fa-solid fa-caret-down caret" style="margin-left:.25rem"></i></summary>
        <div class="menu right">
          <button id="miStationQR" class="menu-item"><i class="fa-solid fa-qrcode"></i> 工程QR</button>
          <button id="miAddUser" class="menu-item"><i class="fa-solid fa-user-plus"></i> ユーザー追加</button>
          <button id="miChangePass" class="menu-item"><i class="fa-solid fa-key"></i> パス変更</button>
          <hr style="border:none;border-top:1px solid var(--border);margin:.35rem 0">
          <button id="btnLogout" class="menu-item"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
        </div>
      </details>
      <span id="userInfo" class="muted"></span>
    </div>
  </nav>

  <a class="corner-brand" href="#" aria-label="Design credit">Design by Wahyu</a>

  <!-- AUTH -->
  <main id="authView" class="container">
    <section class="card card-tight">
      <h2><i class="fa-solid fa-right-to-bracket"></i> ログイン</h2>
      <div class="grid">
        <input id="inUser" placeholder="ユーザー名">
        <input id="inPass" type="password" placeholder="パスワード">
      </div>
      <button id="btnLogin" class="btn primary full" style="margin-top:.8rem">ログイン</button>
      <p class="muted s" style="margin-top:.5rem">初回: <code>admin / admin123</code>（Users空なら自動作成）</p>
    </section>
  </main>

  <!-- DASHBOARD -->
  <main id="pageDash" class="container hidden">
    <section class="card" id="ordersSection">
      <header class="row-between">
        <h3><i class="fa-solid fa-clipboard-list"></i> オーダー一覧</h3>
        <div class="row gap">
          <input id="searchQ" placeholder="検索..." class="input">
          <button class="btn ghost" id="btnExportOrders"><i class="fa-solid fa-file-csv"></i> 注文CSV</button>
          <button class="btn ghost" id="btnExportShip"><i class="fa-solid fa-file-csv"></i> 本日出荷CSV</button>
          <button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button>
        </div>
      </header>
      <div class="table-wrap" style="max-height:55vh">
        <table class="table s">
          <thead>
          <tr><th>注番 / 得意先</th><th>品名</th><th>品番</th><th>図番</th><th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th></tr>
          </thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-gauge"></i> ダッシュボード</h3>
        <div class="row gap">
          <button class="btn ghost" id="btnRefresh"><i class="fa-solid fa-rotate"></i> 更新</button>
          <button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button>
        </div>
      </header>
      <div class="grid-3">
        <div class="tile"><div class="muted s">完成品在庫</div><div id="statFinished" class="stat-num">-</div><div class="muted s"><span id="statReady">-</span> 準備 / <span id="statShipped">-</span> 出荷済</div></div>
        <div class="tile"><div class="muted s">本日の出荷予定</div><div id="listToday" class="list s"></div></div>
        <div class="tile"><div class="muted s">工程内滞留（現在位置）</div><div id="gridProc" class="grid grid-chips"></div></div>
      </div>
    </section>
  </main>

  <!-- 受注 -->
  <main id="pageSales" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-regular fa-handshake"></i> 受注</h3>
        <div class="row">
          <button id="ordCreate" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="ordImport" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="ordExport" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="ordSave"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="ordPrint"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s">
          <thead id="ordHead"></thead>
          <tbody id="ordBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 生産計画 -->
  <main id="pagePlan" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-list-check"></i> 生産計画</h3>
        <div class="row">
          <button id="planCreate" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="planImport" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="planExport" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="planSave"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="planPrint"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s">
          <thead id="planHead"></thead>
          <tbody id="planBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 出荷予定 -->
  <main id="pageShip" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-truck"></i> 出荷予定</h3>
        <div class="row">
          <button id="shipCreate" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="shipImport" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="shipExport" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="shipSave"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="shipPrint"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s">
          <thead id="shipHead"></thead>
          <tbody id="shipBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 在庫 -->
  <main id="pageInventory" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-solid fa-boxes-stacked"></i> 在庫</h3>
        <div class="row">
          <button id="invCreate" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="invImport" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="invExport" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="invSave"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="invPrint"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s">
          <thead id="invHead"></thead>
          <tbody id="invBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 完成品一覧 -->
  <main id="pageFinished" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-regular fa-square-check"></i> 完成品一覧</h3>
        <div class="row">
          <button id="finCreate" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="finImport" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="finExport" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="finSave"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="finPrint"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s">
          <thead id="finHead"></thead>
          <tbody id="finBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- 請求書 -->
  <main id="pageInvoice" class="container hidden">
    <section class="card">
      <header class="row-between">
        <h3><i class="fa-regular fa-file-lines"></i> 請求書</h3>
        <div class="row">
          <button id="invCreate2" class="btn primary"><i class="fa-solid fa-plus"></i> 作成</button>
          <label class="btn ghost"><input id="invImport2" type="file" accept=".csv,.xlsx" hidden> Import</label>
          <button id="invExport2" class="btn ghost"><i class="fa-solid fa-file-export"></i> Export</button>
          <button id="invSave2"   class="btn ghost"><i class="fa-regular fa-floppy-disk"></i> 保存</button>
          <button id="invPrint2"  class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
        </div>
      </header>
      <div class="table-wrap">
        <table class="table s a4">
          <thead id="invHead2"></thead>
          <tbody id="invBody2"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Dialogs -->
  <dialog id="dlgStationQR" class="paper">
    <div class="body"><h3>工程QR（現場掲示用）</h3><p class="muted s">フォーマット: <code>ST:工程名</code></p><div id="qrWrap" class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr));"></div></div>
    <footer class="row-end"><button class="btn" onclick="document.getElementById('dlgStationQR').close()">閉じる</button></footer>
  </dialog>

  <dialog id="dlgScan" class="paper">
    <div class="body">
      <h3>QRスキャン更新（PO: <span id="scanPO"></span>）</h3>
      <p class="muted s">工程QRを読み取ると切替され履歴に記録されます。</p>
      <video id="scanVideo" playsinline></video>
      <canvas id="scanCanvas" class="hidden"></canvas>
      <div id="scanResult" class="muted s" style="margin-top:.5rem"></div>
    </div>
    <footer class="row-end">
      <button class="btn ghost" id="btnScanStart">開始</button>
      <button class="btn" id="btnScanClose">閉じる</button>
    </footer>
  </dialog>
</body>
</html>
