<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>東京精密発條株式会社システム</title>
  <link rel="icon" href="./assets/tsh.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="./style.css">
  <script defer src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script defer src="./app.js"></script>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="nav">
    <div class="nav-left">
      <img src="./assets/tsh.png" alt="" class="logo">
      <span class="brand">東京精密発條株式会社システム</span>
    </div>

    <div id="wx" class="wx">
      <span id="wxCity">取得中…</span>
      <span class="sep">•</span>
      <span id="wxTemp">--℃</span>
      <span id="wxIcon" class="ico"></span>
    </div>

    <div class="nav-right">
      <button id="btnDash" class="chip"><i class="fa-solid fa-gauge"></i> ダッシュボード</button>
      <button id="btnSales" class="chip"><i class="fa-regular fa-handshake"></i> 受注（営業）</button>
      <button id="btnPlan"  class="chip"><i class="fa-solid fa-list-check"></i> 生産計画</button>
      <button id="btnShip"  class="chip"><i class="fa-solid fa-truck"></i> 出荷予定</button>
      <button id="btnInv"   class="chip"><i class="fa-solid fa-boxes-stacked"></i> 在庫</button>
      <button id="btnFin"   class="chip"><i class="fa-regular fa-square-check"></i> 完成品一覧</button>
      <button id="btnInvs"  class="chip"><i class="fa-regular fa-file-lines"></i> 請求書</button>
      <button id="btnStats" class="chip"><i class="fa-solid fa-chart-simple"></i> 統計</button>

      <details class="dd" id="ddSetting">
        <summary class="chip"><i class="fa-solid fa-gear"></i> 設定</summary>
        <div class="menu">
          <button id="miQR" class="menu-item"><i class="fa-solid fa-qrcode"></i> 工程QR</button>
          <button id="miAddUser" class="menu-item"><i class="fa-solid fa-user-plus"></i> ユーザー追加</button>
          <button id="btnLogout" class="menu-item"><i class="fa-solid fa-right-from-bracket"></i> ログアウト</button>
        </div>
      </details>
      <span id="userInfo" class="muted"></span>
    </div>
  </nav>

  <a class="corner" href="#" aria-label="credit">Design by Wahyu</a>

  <!-- AUTH -->
  <main id="authView" class="container">
    <section class="card auth">
      <h2><i class="fa-solid fa-right-to-bracket"></i> ログイン</h2>
      <div class="grid1">
        <input id="inUser" placeholder="ユーザー名">
        <input id="inPass" type="password" placeholder="パスワード">
      </div>
      <details class="card slim">
        <summary><strong><i class="fa-solid fa-user-gear"></i> 管理者: ユーザー追加</strong></summary>
        <div class="grid2">
          <input id="nuUser" placeholder="ユーザー名">
          <input id="nuPass" type="password" placeholder="パスワード">
          <input id="nuName" placeholder="氏名">
          <select id="nuDept">
            <option value="営業">営業</option><option value="生産技術">生産技術</option>
            <option value="生産管理部">生産管理部</option><option value="製造">製造</option><option value="検査">検査</option>
          </select>
          <select id="nuRole">
            <option value="member">member</option><option value="manager">manager</option><option value="admin">admin</option>
          </select>
        </div>
        <button id="btnNewUser" class="btn ghost full">ユーザー追加</button>
        <p class="muted s">初回: <code>admin / admin123</code></p>
      </details>
      <button id="btnLogin" class="btn primary full">ログイン</button>
    </section>
  </main>

  <!-- DASHBOARD + ORDER LIST -->
  <main id="pageDash" class="container hidden">
    <section class="card">
      <header class="row">
        <h3><i class="fa-solid fa-clipboard-list"></i> オーダー一覧</h3>
        <div class="grow"></div>
        <input id="searchQ" class="input" placeholder="検索...">
        <button id="btnOrdExport" class="btn ghost"><i class="fa-solid fa-file-csv"></i> 注文CSV</button>
        <button id="btnShipExport" class="btn ghost"><i class="fa-solid fa-file-csv"></i> 本日出荷CSV</button>
        <button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button>
      </header>
      <div class="table-wrap" style="max-height:55vh">
        <table class="table s">
          <thead>
          <tr><th>注番 / 得意先</th><th>品名</th><th>品番</th><th>図番</th><th>状態</th><th>工程</th><th>更新日時</th><th>更新者</th><th>操作</th></tr>
          </thead>
          <tbody id="tbOrders"></tbody>
        </table>
      </div>
    </section>

    <section class="card">
      <header class="row">
        <h3><i class="fa-solid fa-gauge"></i> ダッシュボード</h3>
        <div class="grow"></div>
        <button id="btnRefresh" class="btn ghost"><i class="fa-solid fa-rotate"></i> 更新</button>
        <button class="btn ghost" onclick="window.print()"><i class="fa-solid fa-print"></i> 印刷</button>
      </header>
      <div class="tiles">
        <div class="tile">
          <div class="muted s">完成品在庫</div>
          <div id="statFinished" class="stat">0</div>
          <div class="muted s"><span id="statReady">0</span> 準備 / <span id="statShipped">0</span> 出荷済</div>
        </div>
        <div class="tile">
          <div class="muted s">本日の出荷予定</div>
          <div id="listToday" class="list s"></div>
        </div>
        <div class="tile">
          <div class="muted s">工程内滞留（現在位置）</div>
          <div id="gridProc" class="chips"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- PAGES (placeholder minimal agar menu nyambung) -->
  <main id="pageSales" class="container hidden"><section class="card"><h3>受注（営業）</h3><div class="bar">
    <button class="btn primary">作成</button><button class="btn ghost" id="btnSalesImp">Import</button>
    <button class="btn ghost" id="btnSalesExp">Export</button><button class="btn ghost">保存</button>
    <button class="btn ghost" onclick="window.print()">印刷</button>
  </div><p class="muted s">（準備中のプレースホルダー。CRUD terhubung ke backend JSONP yang sama）</p></section></main>

  <main id="pagePlan" class="container hidden"><section class="card"><h3>生産計画</h3><div class="bar">
    <button class="btn primary">作成</button><button class="btn ghost">Import</button>
    <button class="btn ghost">Export</button><button class="btn ghost">保存</button>
    <button class="btn ghost" onclick="window.print()">印刷</button>
  </div><p class="muted s">受注から投入された計画がここに表示されます。</p></section></main>

  <main id="pageShip" class="container hidden"><section class="card"><h3>出荷予定</h3><div class="bar">
    <button class="btn primary">作成</button><button class="btn ghost">Import</button>
    <button class="btn ghost">Export</button><button class="btn ghost">保存</button>
    <button class="btn ghost" onclick="window.print()">印刷</button>
  </div><p class="muted s">生産管理が計画から出荷予定を作成し、出荷準備へ。</p></section></main>

  <main id="pageInventory" class="container hidden"><section class="card"><h3>在庫</h3><p class="muted s">在庫管理ページ（placeholder）。</p></section></main>
  <main id="pageFinished" class="container hidden"><section class="card"><h3>完成品一覧</h3><p class="muted s">完成品一覧ページ（placeholder）。</p></section></main>
  <main id="pageInvoice" class="container hidden"><section class="card"><h3>請求書</h3><p class="muted s">請求書ページ（placeholder）。</p></section></main>
  <main id="pageCharts" class="container hidden"><section class="card"><h3>統計</h3><p class="muted s">統計チャート（placeholder）。</p></section></main>

  <!-- 工程QR -->
  <dialog id="dlgQR" class="paper"><div class="body"><h3>工程QR（現場掲示用）</h3><div id="qrWrap" class="qrgrid"></div></div>
    <footer class="row-end"><button class="btn" onclick="document.getElementById('dlgQR').close()">閉じる</button></footer></dialog>

  <!-- スキャン -->
  <dialog id="dlgScan" class="paper">
    <div class="body"><h3>QRスキャン更新（PO: <span id="scanPO"></span>）</h3>
      <video id="scanVideo" playsinline></video><canvas id="scanCanvas" class="hidden"></canvas>
      <div id="scanResult" class="muted s" style="margin-top:.4rem"></div></div>
    <footer class="row-end"><button class="btn ghost" id="btnScanStart">開始</button><button class="btn" id="btnScanClose">閉じる</button></footer>
  </dialog>
</body>
</html>
